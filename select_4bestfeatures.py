import os
import pandas as pd
import numpy as np
from tqdm import tqdm # show progress bar
from regression_function import get_model
from collections import Counter

os.chdir('your path')
dt_combine_fs = pd.read_csv('your data')

#FOR SELECTED VARIABLES
var_feature = ['t1_PSES2', 
               't1_SOLI_total', 
               't1_EASQ_locus','t1_EASQ_stability', 't1_EASQ_globality', 
               't1_BIS', 't1_BAS_drive','t1_BAS_reward_responsiveness', 't1_BAS_fun_seeking',
               't1_RRS_brooding','t1_UCLALS_total', 't1_SSS_total', 
               't1_CTQ_total', 't1_CDRISC_total', 't1_PSS_total']

no_repeat = 10
np.random.seed(1)
rand_num_list1 = np.random.choice(10000,no_repeat,replace=False)
selected_features_ls = []

X = dt_combine_fs[var_feature]
Y = dt_combine_fs['t1_PHQ_total']
for rand_num in tqdm(rand_num_list1):
    inner_results, outer_results, importances, best_estimators, best_params, selected_features = get_model(X, Y, random_state_model=rand_num)
    selected_features_ls.append(selected_features)

counter_features = Counter([fea for features in selected_features_ls for feature in features for fea in feature])
selected_features = [feature for feature in counter_features if counter_features[feature] >= 50]
print(selected_features)

#the selected features' importance
X_selected = dt_combine_fs[selected_features]
importance = get_model(X,Y)[2]
print("the importance of each factors are: " + selected_features)
print(importance)
