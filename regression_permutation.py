import os
import pandas as pd
import numpy as np
from tqdm import tqdm # show progress bar
from permutation_functions import get_permutation_p, get_permutation_p_lasso

os.chdir('your path')
dt_combine_fs = pd.read_csv('your data')
all_y_results = pd.read_excel('your data')

#FOR SELECTED VARIABLES
var_feature = ['t1_PSES2', 
               't1_SOLI_total', 
               't1_EASQ_locus','t1_EASQ_stability', 't1_EASQ_globality', 
               't1_BIS', 't1_BAS_drive','t1_BAS_reward_responsiveness', 't1_BAS_fun_seeking',
               't1_RRS_brooding','t1_UCLALS_total', 't1_SSS_total', 
               't1_CTQ_total', 't1_CDRISC_total', 't1_PSS_total']

Symptoms = ['t1_PSQI_total','t1_DARS_total','t1_RSES_total',
               't1_BHS_total',
               't1_MDMQ_vigilance', 't1_MDMQ_procrastination','t1_MDMQ_hypervigilance', 't1_MDMQ_buckpassing',
              't1_SBQ_total','t1_SCL_total']

Symptoms_w_RSES = ['t1_PSQI_total','t1_DARS_total',
               't1_BHS_total',
               't1_MDMQ_vigilance', 't1_MDMQ_procrastination','t1_MDMQ_hypervigilance', 't1_MDMQ_buckpassing',
              't1_SBQ_total','t1_SCL_total']

#initiate a dataframe to store all DVs' p and permutation r square
all_permutation = pd.DataFrame(columns=["symptom","results_int_permu","results_ext_permu","p_value_int","p_value_ext"])

for symptom in tqdm(Symptoms_w_RSES):
    X = dt_combine_fs[var_feature]
    Y = dt_combine_fs[symptom]
    no_permu = 5000
    #a dataframe to store the int and ext permutation R square, in case for the data lost
    symptom_permu_file = pd.DataFrame(columns=["symptom","results_int_permu","results_ext_permu"])
    results_int_permu, results_ext_permu, score_int, score_ext = get_permutation_p(symptom_permu_file,no_permu,symptom,X,Y,all_y_results)
    p_value_int = (sum(score_int < np.array(results_int_permu))+1) / (no_permu+1)
    p_value_ext = (sum(score_ext < np.array(results_ext_permu))+1) / (no_permu+1)
    all_permutation.loc[len(all_permutation.index)] = [symptom, np.mean(results_int_permu), np.mean(results_ext_permu), p_value_int, p_value_ext]
    os.chdir('your path')
    all_permutation.to_csv("give a name to this data")
